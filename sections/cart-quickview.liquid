{% comment %}
  Cart Quick View - Mini cart drawer
{% endcomment %}

<div id="cart-quickview" class="cart-quickview" data-cart-quickview>
  <div class="cart-quickview__overlay" onclick="closeCartQuickview()"></div>
  
  <div class="cart-quickview__drawer">
    <!-- Header -->
    <div class="cart-quickview__header">
      <h2 class="cart-quickview__title">
        Your Cart ({{ cart.item_count }})
      </h2>
      <button type="button" class="cart-quickview__close" onclick="closeCartQuickview()" aria-label="Close cart">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <!-- Cart Items -->
    <div class="cart-quickview__items">
      {% if cart.item_count > 0 %}
        {% for item in cart.items %}
          <div class="cart-quickview__item" data-cart-item="{{ item.key }}">
            <div class="cart-quickview__item-image">
              {% if item.image %}
                <img src="{{ item.image | image_url: width: 100 }}" alt="{{ item.title }}" width="80" height="80" loading="lazy">
              {% endif %}
            </div>

            <div class="cart-quickview__item-details">
              <a href="{{ item.url }}" class="cart-quickview__item-title">
                {{ item.product.title }}
              </a>
              
              {% if item.variant.title != 'Default Title' %}
                <p class="cart-quickview__item-variant">{{ item.variant.title }}</p>
              {% endif %}

              <div class="cart-quickview__item-price">
                {{ item.final_price | money }}
              </div>

              <!-- Quantity -->
              <div class="cart-quickview__quantity">
                <button type="button" onclick="updateCartQuantity('{{ item.key }}', {{ item.quantity | minus: 1 }})" {% if item.quantity <= 1 %}disabled{% endif %}>
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                  </svg>
                </button>
                
                <input type="number" value="{{ item.quantity }}" min="1" readonly>
                
                <button type="button" onclick="updateCartQuantity('{{ item.key }}', {{ item.quantity | plus: 1 }})">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                  </svg>
                </button>
              </div>
            </div>

            <button type="button" class="cart-quickview__item-remove" onclick="removeFromCart('{{ item.key }}')" aria-label="Remove">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
            </button>
          </div>
        {% endfor %}
      {% else %}
        <div class="cart-quickview__empty">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="8" cy="21" r="1"></circle>
            <circle cx="19" cy="21" r="1"></circle>
            <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"></path>
          </svg>
          <p>Your cart is empty</p>
          <a href="{{ routes.all_products_collection_url }}" class="btn-primary">Continue Shopping</a>
        </div>
      {% endif %}
    </div>

    <!-- Footer -->
    {% if cart.item_count > 0 %}
    <div class="cart-quickview__footer">
      <div class="cart-quickview__subtotal">
        <span>Subtotal</span>
        <span class="cart-quickview__subtotal-amount">{{ cart.total_price | money }}</span>
      </div>
      
      <a href="{{ routes.cart_url }}" class="btn-primary btn-block">View Cart</a>
      <button type="button" onclick="window.location.href='/checkout'" class="btn-primary btn-block">Checkout</button>
    </div>
    {% endif %}
  </div>
</div>

<style>
.cart-quickview {
  position: fixed;
  inset: 0;
  z-index: 100;
  display: none;
}

.cart-quickview.active {
  display: block;
}

.cart-quickview__overlay {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
}

.cart-quickview__drawer {
  position: absolute;
  right: 0;
  top: 0;
  bottom: 0;
  width: 100%;
  max-width: 400px;
  background: white;
  display: flex;
  flex-direction: column;
  box-shadow: -4px 0 12px rgba(0, 0, 0, 0.1);
  animation: slideIn 0.3s ease;
}

.dark .cart-quickview__drawer {
  background: #000;
}

@keyframes slideIn {
  from { transform: translateX(100%); }
  to { transform: translateX(0); }
}

.cart-quickview__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 24px;
  border-bottom: 1px solid #E5E7EB;
}

.dark .cart-quickview__header {
  border-bottom-color: #27272A;
}

.cart-quickview__title {
  font-size: 20px;
  font-weight: 700;
  margin: 0;
}

.cart-quickview__close {
  background: none;
  border: none;
  cursor: pointer;
  padding: 8px;
  color: #6B7280;
}

.cart-quickview__close:hover {
  color: #1F2937;
}

.cart-quickview__items {
  flex: 1;
  overflow-y: auto;
  padding: 24px;
}

.cart-quickview__item {
  display: flex;
  gap: 16px;
  padding-bottom: 24px;
  margin-bottom: 24px;
  border-bottom: 1px solid #E5E7EB;
  position: relative;
}

.dark .cart-quickview__item {
  border-bottom-color: #27272A;
}

.cart-quickview__item-image {
  width: 80px;
  height: 80px;
  border-radius: 8px;
  overflow: hidden;
  background: #F3F4F6;
}

.cart-quickview__item-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.cart-quickview__item-details {
  flex: 1;
}

.cart-quickview__item-title {
  font-weight: 600;
  color: #1F2937;
  text-decoration: none;
  display: block;
  margin-bottom: 4px;
}

.dark .cart-quickview__item-title {
  color: #F9FAFB;
}

.cart-quickview__item-variant {
  font-size: 14px;
  color: #6B7280;
  margin: 0 0 8px;
}

.cart-quickview__item-price {
  font-weight: 700;
  color: var(--brand-pink);
  margin-bottom: 12px;
}

.dark .cart-quickview__item-price {
  color: var(--brand-gold);
}

.cart-quickview__quantity {
  display: flex;
  align-items: center;
  gap: 8px;
}

.cart-quickview__quantity button {
  width: 32px;
  height: 32px;
  border: 1px solid #E5E7EB;
  background: white;
  border-radius: 4px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.dark .cart-quickview__quantity button {
  background: #18181B;
  border-color: #27272A;
}

.cart-quickview__quantity button:hover {
  background: #F3F4F6;
}

.cart-quickview__quantity button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.cart-quickview__quantity input {
  width: 50px;
  height: 32px;
  text-align: center;
  border: 1px solid #E5E7EB;
  border-radius: 4px;
}

.cart-quickview__item-remove {
  position: absolute;
  top: 0;
  right: 0;
  background: none;
  border: none;
  cursor: pointer;
  padding: 4px;
  color: #9CA3AF;
}

.cart-quickview__item-remove:hover {
  color: #EF4444;
}

.cart-quickview__empty {
  text-align: center;
  padding: 60px 20px;
}

.cart-quickview__empty svg {
  margin: 0 auto 16px;
  color: #D1D5DB;
}

.cart-quickview__empty p {
  font-size: 18px;
  color: #6B7280;
  margin-bottom: 24px;
}

.cart-quickview__footer {
  padding: 24px;
  border-top: 1px solid #E5E7EB;
}

.dark .cart-quickview__footer {
  border-top-color: #27272A;
}

.cart-quickview__subtotal {
  display: flex;
  justify-content: space-between;
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 16px;
}

.cart-quickview__subtotal-amount {
  color: var(--brand-pink);
}

.dark .cart-quickview__subtotal-amount {
  color: var(--brand-gold);
}

.btn-block {
  display: block;
  width: 100%;
  margin-bottom: 12px;
  text-align: center;
}
</style>

<script>
function closeCartQuickview() {
  document.getElementById('cart-quickview').classList.remove('active');
  document.body.style.overflow = '';
}

function updateCartQuantity(key, quantity) {
  fetch('/cart/change.js', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ id: key, quantity: quantity })
  })
  .then(res => res.json())
  .then(data => {
    location.reload();
  });
}

function removeFromCart(key) {
  updateCartQuantity(key, 0);
}
</script>

{% schema %}
{
  "name": "Cart Quick View",
  "settings": []
}
{% endschema %}
